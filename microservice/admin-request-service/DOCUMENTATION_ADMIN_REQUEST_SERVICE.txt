# Admin-Request-Service - Documentation ComplÃ¨te

## ğŸ“‹ Vue d'ensemble

Le **admin-request-service** est un microservice Spring Boot dÃ©diÃ© Ã  la gestion des demandes administratives pour une Ã©quipe de volleyball. Il permet la crÃ©ation, validation, suivi et traitement de diffÃ©rents types de demandes administratives.

## ğŸ—ï¸ Architecture Technique

### Technologies UtilisÃ©es
- **Framework**: Spring Boot 3.2.0
- **Langage**: Java 17
- **Base de donnÃ©es**: PostgreSQL 15
- **ORM**: Spring Data JPA / Hibernate
- **SÃ©curitÃ©**: Spring Security (configuration permissive pour dÃ©veloppement)
- **Port**: 8085
- **Conteneurisation**: Docker & Docker Compose

### Structure du Projet
```
admin-request-service/
â”œâ”€â”€ src/main/java/com/volleyball/adminrequestservice/
â”‚   â”œâ”€â”€ AdminRequestServiceApplication.java
â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”œâ”€â”€ AdminRequest.java
â”‚   â”‚   â”œâ”€â”€ RequestType.java
â”‚   â”‚   â”œâ”€â”€ RequestStatus.java
â”‚   â”‚   â””â”€â”€ RequestPriority.java
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â””â”€â”€ AdminRequestRepository.java
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â””â”€â”€ AdminRequestService.java
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ AdminRequestController.java
â”‚   â””â”€â”€ config/
â”‚       â””â”€â”€ SecurityConfig.java
â”œâ”€â”€ src/main/resources/
â”‚   â””â”€â”€ application.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ pom.xml
```

## ğŸ“Š ModÃ¨le de DonnÃ©es

### EntitÃ© AdminRequest
- **id**: Identifiant unique (Long)
- **requesterId**: ID du demandeur (Long)
- **title**: Titre de la demande (String, max 200 caractÃ¨res)
- **description**: Description dÃ©taillÃ©e (String, max 2000 caractÃ¨res)
- **type**: Type de demande (RequestType enum)
- **priority**: PrioritÃ© (RequestPriority enum)
- **status**: Statut (RequestStatus enum)
- **assignedTo**: ID de l'assignÃ© (Long, optionnel)
- **budgetRequested**: Budget demandÃ© (Double, optionnel)
- **dateNeeded**: Date limite (LocalDateTime, optionnel)
- **adminComments**: Commentaires admin (String, max 1000 caractÃ¨res)
- **rejectionReason**: Raison du rejet (String, max 500 caractÃ¨res)
- **createdAt**: Date de crÃ©ation (LocalDateTime)
- **updatedAt**: Date de mise Ã  jour (LocalDateTime)
- **processedAt**: Date de traitement (LocalDateTime)
- **approvedAt**: Date d'approbation (LocalDateTime)
- **approvedBy**: ID de l'approbateur (Long)

### Ã‰numÃ©rations

#### RequestType
- `CONGE`: Demande de congÃ©
- `ABSENCE`: Justification d'absence
- `MATERIEL`: Demande de matÃ©riel
- `TRANSPORT`: Demande de transport
- `HEBERGEMENT`: Demande d'hÃ©bergement
- `BUDGET`: Demande budgÃ©taire
- `FORMATION`: Demande de formation
- `EVENEMENT`: Organisation d'Ã©vÃ©nement
- `PARTENARIAT`: Demande de partenariat
- `AUTRE`: Autre demande

#### RequestStatus
- `BROUILLON`: Brouillon
- `SOUMISE`: Soumise
- `EN_COURS`: En cours de traitement
- `EN_ATTENTE`: En attente d'informations
- `APPROUVEE`: ApprouvÃ©e
- `REJETEE`: RejetÃ©e
- `ANNULEE`: AnnulÃ©e
- `TERMINEE`: TerminÃ©e

#### RequestPriority
- `BASSE`: PrioritÃ© basse
- `NORMALE`: PrioritÃ© normale
- `HAUTE`: PrioritÃ© haute
- `URGENTE`: PrioritÃ© urgente
- `CRITIQUE`: PrioritÃ© critique

## ğŸ”Œ API Endpoints

### Base URL: `http://localhost:8085/api/admin-requests`

### CRUD Operations

#### 1. CrÃ©er une demande
- **POST** `/api/admin-requests`
- **Body**: AdminRequest JSON
- **Retour**: AdminRequest crÃ©Ã©e (201)

#### 2. RÃ©cupÃ©rer toutes les demandes
- **GET** `/api/admin-requests`
- **Retour**: Liste des demandes (200)

#### 3. RÃ©cupÃ©rer une demande par ID
- **GET** `/api/admin-requests/by-id?id={id}`
- **Retour**: AdminRequest (200) ou Not Found (404)

#### 4. Mettre Ã  jour une demande
- **PUT** `/api/admin-requests/update?id={id}`
- **Body**: AdminRequest JSON
- **Retour**: AdminRequest mise Ã  jour (200)

#### 5. Supprimer une demande
- **DELETE** `/api/admin-requests/delete?id={id}`
- **Retour**: Message de confirmation (200)

### Endpoints de Filtrage

#### 6. Demandes par demandeur
- **GET** `/api/admin-requests/requester?requesterId={id}`

#### 7. Demandes par statut
- **GET** `/api/admin-requests/by-status?status={status}`

#### 8. Demandes par type
- **GET** `/api/admin-requests/by-type?type={type}`

#### 9. Demandes par prioritÃ©
- **GET** `/api/admin-requests/by-priority?priority={priority}`

#### 10. Demandes assignÃ©es
- **GET** `/api/admin-requests/assigned?assignedTo={id}`

### Endpoints SpÃ©cialisÃ©s

#### 11. Demandes en attente
- **GET** `/api/admin-requests/pending`

#### 12. Demandes urgentes
- **GET** `/api/admin-requests/urgent`

#### 13. Demandes rÃ©centes
- **GET** `/api/admin-requests/recent?days={days}`

#### 14. Recherche de demandes
- **GET** `/api/admin-requests/search?searchTerm={term}`

#### 15. Demandes avec budget
- **GET** `/api/admin-requests/with-budget`

#### 16. Demandes prioritaires assignÃ©es
- **GET** `/api/admin-requests/high-priority-assigned?assignedTo={id}`

### Actions sur les Demandes

#### 17. Soumettre une demande
- **PUT** `/api/admin-requests/submit?id={id}`

#### 18. Assigner une demande
- **PUT** `/api/admin-requests/assign?id={id}&assignedTo={userId}`

#### 19. Approuver une demande
- **PUT** `/api/admin-requests/approve?id={id}&approvedBy={userId}&comments={comments}`

#### 20. Rejeter une demande
- **PUT** `/api/admin-requests/reject?id={id}&reason={reason}&rejectedBy={userId}`

#### 21. Annuler une demande
- **PUT** `/api/admin-requests/cancel?id={id}`

#### 22. Marquer comme terminÃ©e
- **PUT** `/api/admin-requests/complete?id={id}`

### Analytics et Statistiques

#### 23. Statistiques complÃ¨tes
- **GET** `/api/admin-requests/statistics`
- **Retour**: Statistiques par statut, type, prioritÃ©, budget, temps de traitement

#### 24. Compteurs du tableau de bord
- **GET** `/api/admin-requests/dashboard`
- **Retour**: Compteurs des demandes en attente, urgentes, approuvÃ©es, rejetÃ©es

#### 25. Compter par statut pour un demandeur
- **GET** `/api/admin-requests/count?requesterId={id}&status={status}`

## ğŸ“‹ Exemples de RequÃªtes

### CrÃ©er une demande de congÃ©
```json
POST /api/admin-requests
{
    "requesterId": 1,
    "title": "Demande de congÃ© Ã©tÃ© 2024",
    "description": "Demande de congÃ© pour les vacances d'Ã©tÃ© du 15 juillet au 30 aoÃ»t 2024",
    "type": "CONGE",
    "priority": "NORMALE",
    "dateNeeded": "2024-07-15T00:00:00"
}
```

### CrÃ©er une demande de matÃ©riel urgente
```json
POST /api/admin-requests
{
    "requesterId": 2,
    "title": "Achat ballons de volleyball",
    "description": "Besoin urgent de 20 ballons de volleyball pour l'entraÃ®nement",
    "type": "MATERIEL",
    "priority": "URGENTE",
    "budgetRequested": 500.00,
    "dateNeeded": "2024-08-20T00:00:00"
}
```

### Approuver une demande
```
PUT /api/admin-requests/approve?id=1&approvedBy=3&comments=Demande approuvÃ©e, budget allouÃ©
```

### Rechercher des demandes
```
GET /api/admin-requests/search?searchTerm=ballon
```

## ğŸš€ DÃ©ploiement

### Avec Docker Compose
```bash
# Construire et dÃ©marrer les services
docker-compose up --build -d

# VÃ©rifier le statut
docker ps

# Voir les logs
docker-compose logs admin-request-service
```

### Configuration Base de DonnÃ©es
- **Host**: localhost
- **Port**: 5435 (PostgreSQL dans Docker)
- **Database**: admin_request_db
- **User**: admin_request_user
- **Password**: root

### Ports
- **Application**: 8085
- **PostgreSQL**: 5435

## ğŸ§ª Tests

### Test de santÃ© du service
```bash
curl http://localhost:8085/api/admin-requests
```

### Test de crÃ©ation de demande
```bash
curl -X POST http://localhost:8085/api/admin-requests \
  -H "Content-Type: application/json" \
  -d '{
    "requesterId": 1,
    "title": "Test Request",
    "description": "Test Description",
    "type": "AUTRE",
    "priority": "NORMALE"
  }'
```

## ğŸ”§ Configuration

### Variables d'environnement
- `DATABASE_URL`: URL de la base de donnÃ©es
- `DATABASE_USERNAME`: Nom d'utilisateur DB
- `DATABASE_PASSWORD`: Mot de passe DB
- `SPRING_JPA_HIBERNATE_DDL_AUTO`: Mode DDL (create-drop, update, etc.)
- `LOG_LEVEL`: Niveau de logging

### Profils Spring
- **DÃ©veloppement**: Configuration par dÃ©faut avec DDL create-drop
- **Production**: RecommandÃ© d'utiliser DDL validate ou update

## ğŸ“Š Monitoring

### Endpoints de santÃ©
- **Health Check**: `/actuator/health`
- **Info**: `/actuator/info`
- **Metrics**: `/actuator/metrics`

## ğŸ”’ SÃ©curitÃ©

### Configuration actuelle
- **Authentification**: DÃ©sactivÃ©e (dÃ©veloppement)
- **CORS**: ActivÃ© pour toutes les origines
- **CSRF**: DÃ©sactivÃ©
- **Headers de sÃ©curitÃ©**: ConfigurÃ©s (HSTS, X-Content-Type-Options, etc.)

### Recommandations pour la production
1. Activer l'authentification JWT
2. Configurer CORS spÃ©cifiquement
3. Activer CSRF si nÃ©cessaire
4. ImplÃ©menter l'autorisation basÃ©e sur les rÃ´les

## ğŸš¨ DÃ©pannage

### ProblÃ¨mes courants
1. **Port 8085 occupÃ©**: ArrÃªter le processus ou changer le port
2. **Connexion DB Ã©chouÃ©e**: VÃ©rifier PostgreSQL et les credentials
3. **Erreurs de validation**: VÃ©rifier les champs requis dans les requÃªtes JSON

### Logs utiles
```bash
# Logs du service
docker-compose logs admin-request-service

# Logs de la base de donnÃ©es
docker-compose logs postgres
```

## ğŸ“ˆ Ã‰volutions Futures

### FonctionnalitÃ©s Ã  ajouter
1. **Notifications**: IntÃ©gration avec le messaging-service
2. **Workflow**: Ã‰tapes de validation personnalisables
3. **Documents**: Gestion des piÃ¨ces jointes
4. **Historique**: Audit trail des modifications
5. **Rapports**: GÃ©nÃ©ration de rapports PDF
6. **API Gateway**: IntÃ©gration dans une architecture microservices

---

**Version**: 1.0.0  
**Date**: AoÃ»t 2024  
**Auteur**: Ã‰quipe de dÃ©veloppement volleyball  
**Contact**: admin@volleyball-team.com
